<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Getting data &#8212; Trading With Python  documentation</title>
    
    <link rel="stylesheet" href="_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="Trading With Python  documentation" href="index.html" />
    <link rel="next" title="Backtesting" href="backtest.html" />
    <link rel="prev" title="Welcome to TradingWithPython documentation!" href="index.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="backtest.html" title="Backtesting"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Welcome to TradingWithPython documentation!"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Trading With Python  documentation</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="getting-data">
<h1>Getting data<a class="headerlink" href="#getting-data" title="Permalink to this headline">¶</a></h1>
<div class="section" id="interactive-brokers-historic-data">
<h2>Interactive Brokers historic data<a class="headerlink" href="#interactive-brokers-historic-data" title="Permalink to this headline">¶</a></h2>
<p>Interactive Brokers provides <em>free</em> historic data (only for clients) up to 6 month in the past, with a maximum resolution
of 1 second bars.  This is great of course, but to prevent abuse, IB imposed all kinds of download limitations.
You are not allowed to make more than 60 data requests per 10 minutes for example and the number of bars per request
is limited.</p>
<p>The script <code class="docutils literal"><span class="pre">tools/getData.py</span></code> is designed to download large datasets while respecting the rules.</p>
<span class="target" id="module-getData"></span><p>This script downloads historic data for single or multiple securities through the
Interactive brokers API.</p>
<ul>
<li><p class="first">the tool is run from the command line (see parameters below)</p>
</li>
<li><dl class="first docutils">
<dt>configuration is done in <code class="docutils literal"><span class="pre">settings.yml</span></code>. Here a list of security definitions is kept</dt>
<dd><p class="first last">together with data destination folder</p>
</dd>
</dl>
</li>
<li><p class="first">the data is saved as <code class="docutils literal"><span class="pre">.csv</span></code> files in a directory structure.</p>
</li>
</ul>
<div class="section" id="running-script">
<h3>Running script<a class="headerlink" href="#running-script" title="Permalink to this headline">¶</a></h3>
<p>Download historic data</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">usage</span><span class="p">:</span> <span class="n">getData</span> <span class="p">[</span><span class="o">-</span><span class="n">h</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">symbols</span> <span class="n">SYMBOLS</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">end</span> <span class="n">END</span><span class="p">]</span>
</pre></div>
</div>
<dl class="docutils">
<dt>Options:</dt>
<dd><table class="first last docutils option-list" frame="void" rules="none">
<col class="option" />
<col class="description" />
<tbody valign="top">
<tr><td class="option-group">
<kbd><span class="option">--symbols=all</span></kbd></td>
<td>symbols separated by comma: SPY,VXX</td></tr>
<tr><td class="option-group">
<kbd><span class="option">--end</span></kbd></td>
<td>timestamp from where to start download.                         Defaults to last trading date</td></tr>
</tbody>
</table>
</dd>
</dl>
</div>
</div>
<div class="section" id="module-tickLogger">
<span id="interactive-brokers-tick-data"></span><h2>Interactive Brokers tick data<a class="headerlink" href="#module-tickLogger" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal"><span class="pre">tickLogger.py</span></code> is a script to log tick events to a file.</p>
<ul class="simple">
<li>symbols to log and data location are stored in a <cite>yml</cite> config file</li>
<li>default configuration is read from <code class="docutils literal"><span class="pre">settings.yml</span></code> , you can provide different
file through command line parameter.</li>
<li>ticks are logged to a rotating csv file, new file will start on midnight</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you need to run this program for longer time periods, it is advisable
to use IB Gateway instead of IB TWS. The latter will automatically log off at
the end of each day.</p>
</div>
<div class="section" id="id1">
<h3>Running script<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>Log ticks for a set of stocks</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">usage</span><span class="p">:</span> <span class="n">tickLogger</span> <span class="p">[</span><span class="o">-</span><span class="n">h</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">settings</span> <span class="n">SETTINGS</span><span class="p">]</span>
</pre></div>
</div>
<dl class="docutils">
<dt>Options:</dt>
<dd><table class="first last docutils option-list" frame="void" rules="none">
<col class="option" />
<col class="description" />
<tbody valign="top">
<tr><td class="option-group" colspan="2">
<kbd><span class="option">--settings=settings.yml</span></kbd></td>
</tr>
<tr><td>&nbsp;</td><td>ini file containing settings</td></tr>
</tbody>
</table>
</dd>
</dl>
</div>
</div>
<div class="section" id="yahoo-finance">
<h2>Yahoo Finance<a class="headerlink" href="#yahoo-finance" title="Permalink to this headline">¶</a></h2>
<div class="section" id="getting-historic-data">
<h3>Getting historic data<a class="headerlink" href="#getting-historic-data" title="Permalink to this headline">¶</a></h3>
<p>The module is usually imported as follows:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [1]: </span><span class="kn">from</span> <span class="nn">tradingWithPython</span> <span class="kn">import</span> <span class="n">yahooFinance</span> <span class="k">as</span> <span class="n">yf</span>
</pre></div>
</div>
</div>
<div class="section" id="singe-symbol">
<h3>Singe symbol<a class="headerlink" href="#singe-symbol" title="Permalink to this headline">¶</a></h3>
<p>Then, to get raw yahoo finance data for a symbol use <a class="reference internal" href="#tradingWithPython.lib.yahooFinance.getSymbolData" title="tradingWithPython.lib.yahooFinance.getSymbolData"><code class="xref py py-func docutils literal"><span class="pre">getSymbolData()</span></code></a></p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [2]: </span><span class="n">df</span> <span class="o">=</span> <span class="n">yf</span><span class="o">.</span><span class="n">getSymbolData</span><span class="p">(</span><span class="s2">&quot;SPY&quot;</span><span class="p">)</span>
<span class="go">Got 5978 days of data</span>

<span class="gp">In [3]: </span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
<span class="go">                      Out[3]: </span>
<span class="go">            adj_close    close     high      low     open     volume</span>
<span class="go">1993-01-29  28.165877  43.9375  43.9687  43.7500  43.9687  1003200.0</span>
<span class="go">1993-02-01  28.366203  44.2500  44.2500  43.9687  43.9687   480500.0</span>
<span class="go">1993-02-02  28.426269  44.3437  44.3750  44.1250  44.2187   201300.0</span>
<span class="go">1993-02-03  28.726791  44.8125  44.8437  44.3750  44.4062   529400.0</span>
<span class="go">1993-02-04  28.846986  45.0000  45.0937  44.4687  44.9687   531500.0</span>
</pre></div>
</div>
<p>We can also normalize OHLC with the <em>adj_close</em> data column. After normalization,
the <em>close</em> column will be equal to <em>adj_close</em> , so the latter is omitted from the result.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [4]: </span><span class="n">df</span> <span class="o">=</span> <span class="n">yf</span><span class="o">.</span><span class="n">getSymbolData</span><span class="p">(</span><span class="s2">&quot;SPY&quot;</span><span class="p">,</span><span class="n">adjust</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="go">Got 5978 days of data</span>

<span class="gp">In [5]: </span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
<span class="go">                      Out[5]: </span>
<span class="go">                close     volume       open       high        low</span>
<span class="go">1993-01-29  28.165877  1003200.0  28.185878  28.185878  28.045681</span>
<span class="go">1993-02-01  28.366203   480500.0  28.185877  28.366203  28.185877</span>
<span class="go">1993-02-02  28.426269   201300.0  28.346138  28.446334  28.286073</span>
<span class="go">1993-02-03  28.726791   529400.0  28.466335  28.746792  28.446334</span>
<span class="go">1993-02-04  28.846986   531500.0  28.826921  28.907052  28.506399</span>
</pre></div>
</div>
</div>
<div class="section" id="multiple-symbols">
<h3>Multiple symbols<a class="headerlink" href="#multiple-symbols" title="Permalink to this headline">¶</a></h3>
<p><a class="reference internal" href="#tradingWithPython.lib.yahooFinance.getHistoricData" title="tradingWithPython.lib.yahooFinance.getHistoricData"><code class="xref py py-func docutils literal"><span class="pre">getHistoricData()</span></code></a> will accept one ore more symbols and download them
while displaying a progress bar.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [6]: </span><span class="n">symbols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;XLE&#39;</span><span class="p">,</span><span class="s1">&#39;USO&#39;</span><span class="p">,</span><span class="s1">&#39;SPY&#39;</span><span class="p">]</span>

<span class="gp">In [7]: </span><span class="n">data</span> <span class="o">=</span> <span class="n">yf</span><span class="o">.</span><span class="n">getHistoricData</span><span class="p">(</span><span class="n">symbols</span><span class="p">)</span>
<span class="go">Downloading data:</span>

<span class="go"> [                       0%                       ]</span>
<span class="go"> [**********************67%*******                ]  2 of 3 complete</span>
<span class="go"> [*********************100%***********************]  3 of 3 complete</span>
<span class="gp">In [8]: </span><span class="k">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="go">                                                                                                                                                                                                                &lt;class &#39;pandas.core.panel.Panel&#39;&gt;</span>
<span class="go">Dimensions: 3 (items) x 5978 (major_axis) x 6 (minor_axis)</span>
<span class="go">Items axis: SPY to XLE</span>
<span class="go">Major_axis axis: 1993-01-29 00:00:00 to 2016-10-21 00:00:00</span>
<span class="go">Minor_axis axis: adj_close to volume</span>
</pre></div>
</div>
</div>
<div class="section" id="getting-current-quotes">
<h3>Getting current quotes<a class="headerlink" href="#getting-current-quotes" title="Permalink to this headline">¶</a></h3>
<p>The <code class="xref py py-func docutils literal"><span class="pre">getQuote()</span></code> is used to get current quote</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [9]: </span><span class="n">quote</span> <span class="o">=</span> <span class="n">yf</span><span class="o">.</span><span class="n">getQuote</span><span class="p">([</span><span class="s1">&#39;SPY&#39;</span><span class="p">,</span><span class="s1">&#39;XLE&#39;</span><span class="p">,</span><span class="s1">&#39;QQQ&#39;</span><span class="p">])</span>

<span class="gp">In [10]: </span><span class="n">quote</span>
<span class="gh">Out[10]: </span><span class="go"></span>
<span class="go">     PE change_pct    eps    last  market_cap  prev_close  short_ratio    time</span>
<span class="go">SPY NaN     +0.05%   4.09  213.98         NaN      213.88          NaN  8:00pm</span>
<span class="go">XLE NaN     -0.65% -10.32   70.19         NaN       70.65          NaN  8:00pm</span>
<span class="go">QQQ NaN     +0.37%   3.41  118.15         NaN      117.71          NaN  4:00pm</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">YahooFinance quotes may be delayed for more than 15 minutes</p>
</div>
</div>
</div>
<div class="section" id="functions">
<h2>Functions<a class="headerlink" href="#functions" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="tradingWithPython.lib.yahooFinance.getSymbolData">
<code class="descclassname">tradingWithPython.lib.yahooFinance.</code><code class="descname">getSymbolData</code><span class="sig-paren">(</span><em>symbol</em>, <em>sDate=(1990</em>, <em>1</em>, <em>1)</em>, <em>eDate=None</em>, <em>adjust=False</em>, <em>verbose=True</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tradingWithPython/lib/yahooFinance.html#getSymbolData"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#tradingWithPython.lib.yahooFinance.getSymbolData" title="Permalink to this definition">¶</a></dt>
<dd><p>get data from Yahoo finance and return pandas dataframe</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>symbol</strong> : str</p>
<blockquote>
<div><p>Yahoo finanance symbol</p>
</div></blockquote>
<p><strong>sDate</strong> : tuple , optional</p>
<blockquote>
<div><p>start date (y,m,d), defaults to 1 jan 1990</p>
</div></blockquote>
<p><strong>eDate</strong> : tuple , optional</p>
<blockquote>
<div><p>end date (y,m,d), defaults to current date</p>
</div></blockquote>
<p><strong>adjust</strong> : bool , optional</p>
<blockquote>
<div><p>use adjusted close values to correct OHLC. adj_close will be ommited</p>
</div></blockquote>
<p><strong>verbose</strong> : bool , optional</p>
<blockquote>
<div><p>print output</p>
</div></blockquote>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">DataFrame</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="tradingWithPython.lib.yahooFinance.getHistoricData">
<code class="descclassname">tradingWithPython.lib.yahooFinance.</code><code class="descname">getHistoricData</code><span class="sig-paren">(</span><em>symbols</em>, <em>**options</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tradingWithPython/lib/yahooFinance.html#getHistoricData"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#tradingWithPython.lib.yahooFinance.getHistoricData" title="Permalink to this definition">¶</a></dt>
<dd><p>get data from Yahoo finance and return pandas dataframe
Will get OHLCV data frame if sinle symbol is provided. 
If many symbols are provided, it will return a wide panel</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>symbols</strong> : str or list</p>
<blockquote>
<div><p>Yahoo finanance symbol or a list of symbols</p>
</div></blockquote>
<p><strong>sDate</strong> : tuple  (optional)</p>
<blockquote>
<div><p>start date (y,m,d)</p>
</div></blockquote>
<p><strong>eDate</strong> : tuple  (optional)</p>
<blockquote>
<div><p>end date (y,m,d)</p>
</div></blockquote>
<p><strong>adjust</strong> : bool</p>
<blockquote>
<div><p>T/[F] adjust data based on adj_close</p>
</div></blockquote>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">Panel</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h3><a href="index.html">Table Of Contents</a></h3>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Getting data</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#interactive-brokers-historic-data">Interactive Brokers historic data</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#running-script">Running script</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#module-tickLogger">Interactive Brokers tick data</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1">Running script</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#yahoo-finance">Yahoo Finance</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#getting-historic-data">Getting historic data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#singe-symbol">Singe symbol</a></li>
<li class="toctree-l3"><a class="reference internal" href="#multiple-symbols">Multiple symbols</a></li>
<li class="toctree-l3"><a class="reference internal" href="#getting-current-quotes">Getting current quotes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#functions">Functions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="backtest.html">Backtesting</a></li>
</ul>

  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/historicData.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="backtest.html" title="Backtesting"
             >next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Welcome to TradingWithPython documentation!"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Trading With Python  documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2016, Jev Kuznetsov.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.4.6.
    </div>
  </body>
</html>